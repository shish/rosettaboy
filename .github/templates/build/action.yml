name: format

inputs:
  deps:
    required: false
  workdir:
    required: true
  cache-paths:
    required: false
  cache-key:
    required: false

runs:
  using: "composite"
  steps:
  - name: Set Up Cache
    if: inputs.cache-key
    uses: actions/cache@v3
    with:
      path: ${{ inputs.cache-paths }} 
      key: ${{ inputs.workdir }}-build-${{ inputs.cache-key }}
      restore-keys: ${{ inputs.workdir }}-
  - name: Install Deps
    if: inputs.deps
    shell: bash
    working-directory: ${{ inputs.workdir }}
    run: ${{ inputs.deps }}
  - name: Build
    shell: bash
    run: ./${{ inputs.workdir }}/run.sh --help
  - name: CPU Integration Tests
    shell: bash
    run: ./utils/blargg.py ${{ inputs.workdir }}
  - name: Benchmark
    shell: bash
    run: ./utils/bench.py ${{ inputs.workdir }} --default --frames 10
